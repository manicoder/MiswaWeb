import React, { useState, useEffect } from 'react';
import { Copy, Loader2 } from 'lucide-react';
import { getUPIPaymentInfo, UPIPaymentInfo } from '../utils/api';
import { motion } from 'framer-motion';
import { useToast } from '../hooks/use-toast';

// UPI App Icons as SVG Components
const PhonePeIcon = () => (
  <svg width="64" height="64" viewBox="0 0 1366 768" xmlns="http://www.w3.org/2000/svg" style={{ width: '64px', height: '64px' }}>
  <defs>
    <clipPath id="phonepe-clip">
      <rect width="1366" height="768" fill="none"></rect>
    </clipPath>
  </defs>
  <g clipPath="url(#phonepe-clip)">
    <path fill="#5f259f" d="M332.63 514.18c-3.88-.38-7.78-.64-11.64-1.15-25.26-3.35-47.76-13.07-67.18-29.6a127.87 127.87 0 0 1-41.44-65.75 124.29 124.29 0 0 1-3.78-42.55c2-24.95 10.33-47.61 25.5-67.51 21.24-27.87 49.33-44.9 84-50.05 37.84-5.63 72 3.92 101.51 28.13 25.43 20.83 40.77 47.94 45.43 80.46 5.5 38.35-4.36 72.79-29.38 102.44-21.07 25-48.24 39.43-80.53 44.3-4.05.62-8.16.86-12.24 1.28zm-23.78-171c-10.43 0-20.85 0-31.28 0-2.78 0-3.77.84-4 3.58a35.11 35.11 0 0 0 .15 8 9.19 9.19 0 0 0 9.18 8.06c2.4.05 4.8 0 7.2 0 3 0 3 0 3 2.95q0 16.75 0 33.5a50.67 50.67 0 0 0 1.73 13.2c3.21 12 10.21 20.59 22.36 24.17 10.15 3 20.34 2.27 30.36-1 2.35-.77 2.39-.77 2.4 1.72 0 6.92-.05 13.84 0 20.76a11.07 11.07 0 0 0 11.25 11.22c3.29 0 6.59.06 9.88 0a4.2 4.2 0 0 0 4.29-4.3c0-.82 0-1.64 0-2.46q0-48.42 0-96.81c0-3.68 0-3.68 3.58-3.68 4.18 0 8.37 0 12.55 0 3.1 0 4-.95 4-4.1q0-3.07 0-6.17c-.07-5.6-3.83-9.33-9.48-9.38q-7.41-.06-14.81 0a4 4 0 0 1-3.41-1.51c-1.85-2.2-3.77-4.35-5.66-6.51Q346 315.77 329.79 297.18a13.29 13.29 0 0 0-10.6-5c-6.67.08-12.59 3-18.74 5.07-1.87.62-2.07 3-.76 4.5a20 20 0 0 0 1.46 1.45Q321.07 322.11 341 341c.48.45 1.36.88 1.14 1.57-.28.9-1.29.53-2 .53-10.43 0-20.85 0-31.28 0M1158.42 427c-1.38 2.26-3.36 3.07-6.05 3.05-13.65-.1-27.3 0-40.95-.09-2 0-2.9.46-2.82 2.59.07 1.56-.34 3.13-.36 4.7-.11 7.55 4.75 12.61 12.33 13.16s14.78-1.54 21.66-4.74c4.91-2.27 5.88-2 8.89 2.6 2.14 3.26 4 6.58 2.52 10.73a10 10 0 0 1-4.77 5.69c-10.45 5.53-21.64 7.14-33.3 6.12a42.24 42.24 0 0 1-15.77-4.33c-11.57-6-17.36-15.76-17.91-28.45-.46-10.6-.24-21.24-.06-31.86.29-18.13 12.62-31.35 31-33.51a57.6 57.6 0 0 1 19.64.67c14.66 3.35 23.45 12.93 25.57 27.82.08.53.23 1.06.35 1.59zm-36.92-12.42c3.84 0 7.68 0 11.52 0 1.39 0 2-.5 2-1.92 0-2.19 0-4.38 0-6.57-.25-7-4.21-11.67-11.19-12.56-8.84-1.13-15.34 3.42-15.52 12.79 0 2 .07 4 0 6s.67 2.36 2.42 2.31c3.63-.09 7.26 0 10.9 0M550.94 450.08c0 4.8 0 9.59 0 14.39 0 3.27-1.71 5.18-5 5.26q-7.71.18-15.42 0c-3-.07-4.64-1.74-5-4.68a18.35 18.35 0 0 1-.13-2.46q0-54.66 0-109.32c0-1 .09-1.92.18-2.87a6.32 6.32 0 0 1 4.67-5.67c11.27-3.75 22.81-6 34.72-5.69 9.35.27 18.19 2.5 26 7.88 9 6.17 14.39 14.76 15.69 25.46a114.65 114.65 0 0 1-.17 32.15 37.2 37.2 0 0 1-32.62 30.79c-7.15.87-14.24.86-21.12-1.65-1.53-.56-1.77.13-1.77 1.42 0 5 0 10 0 15m.79-63.37c0 7.12.06 14.23 0 21.35a3.19 3.19 0 0 0 2.24 3.38c3.77 1.71 7.71 1.75 11.7 1.53 9.35-.51 16-7.36 16-16.72-.05-6.94.53-13.88-.75-20.82-1-5.57-3.43-9.93-8.67-12.37-6.18-2.88-12.49-2.51-18.84-.59-1.44.44-1.61 1.4-1.61 2.68 0 7.18 0 14.37 0 21.56M990.88 407.68V353.2c0-5.69 1.28-7.39 6.65-9.08 10.54-3.31 21.29-5.35 32.36-5.1 10.67.24 20.62 2.91 29.1 9.78a35.37 35.37 0 0 1 13.21 23.86 114.3 114.3 0 0 1 0 30.75c-2.49 16.62-13.65 27.94-30.3 31.43a43 43 0 0 1-23.15-1c-1.82-.64-2.24-.15-2.23 1.65.06 9.39 0 18.78 0 28.16 0 4.41-1.69 6.15-6 6.17s-8.78 0-13.17 0-6.35-1.86-6.4-6.38V407.68zm26.42-21c0 7.19.05 14.39 0 21.58a3 3 0 0 0 2 3.12c3.75 1.77 7.69 1.84 11.69 1.64 9.49-.45 16.12-7.31 16.21-16.78 0-4.59 0-9.19 0-13.78a39.82 39.82 0 0 0-1.77-10.63 13.1 13.1 0 0 0-7.08-8.4c-6.09-3.1-12.41-2.85-18.83-1.17a2.64 2.64 0 0 0-2.27 3c.1 7.13 0 14.25 0 21.38M620.67 404q0-29.81 0-59.62c0-4.51 1.64-6.19 6.21-6.16 3.29 0 6.59-.28 9.86.27a10.91 10.91 0 0 1 9.27 9.65c.67 6.63.14 13.29.27 19.93 0 1.78.06 3.56 0 5.34-.06 1.51.33 2.15 2 1.68a69.5 69.5 0 0 1 13.78-2.15c17.51-1.32 31.54 8.93 35.3 26a54.47 54.47 0 0 1 1.36 12c0 17.62 0 35.23 0 52.84 0 4.13-1.74 5.92-5.83 6q-3.92.06-7.82 0a11.92 11.92 0 0 1-12-12.08q-.06-22.41 0-44.81a29.29 29.29 0 0 0-1-8.75c-1.49-4.84-4.8-7.51-9.75-8.26a36.52 36.52 0 0 0-13.65.92c-1.9.43-2.49 1.37-2.48 3.29q.09 30.84 0 61.67c0 .82 0 1.65 0 2.47-.27 3.74-2 5.49-5.76 5.54q-7.1.09-14.2 0c-3.87 0-5.62-1.86-5.62-5.73q0-30 0-60M712.11 420.9c.23-4.79-.42-11 .33-17.11 1.81-14.86 10-24.47 24.27-28.7a53.23 53.23 0 0 1 35.12 1.13c13.13 5.1 20 15.06 21.11 29 .81 10.25.38 20.54.27 30.81s-3.26 19.68-11.48 26.68c-6.17 5.26-13.53 7.69-21.41 8.7a54.73 54.73 0 0 1-25.17-2.34c-14.06-4.85-22.83-16.93-23-31.78-.07-5 0-10 0-16.37m26.94.25c0 5.54-.07 10 0 14.44.15 7.85 3.83 12.37 11.43 13.33 9 1.15 16.81-2 17.09-12.94.23-9.1.16-18.21 0-27.32-.13-7.43-4-12.17-10.56-13.47a24.66 24.66 0 0 0-5.95-.19c-6.47.31-10.85 4.42-11.7 10.82-.71 5.46-.11 10.95-.34 15.33M949.33 430c-7.07 0-14.13.06-21.2 0-1.78 0-2.52.66-2.58 2.33-.07 2.32-.7 4.61-.38 7 .86 6.36 5.53 10.62 12.08 11.14 7.62.6 14.68-1.28 21.47-4.52 5.36-2.56 6.43-2.26 9.62 2.82 2.13 3.38 3.9 6.85 2 11a8.66 8.66 0 0 1-3.72 4.52c-16.52 8.35-33.49 10-50.45 1.88-10.56-5-16.23-14.28-17.12-25.86a263.21 263.21 0 0 1 0-37.15c.89-13.92 10.1-24.95 24-28.92a51.91 51.91 0 0 1 29.23-.07c13 3.79 20.43 12.79 22.58 26 1.32 8.22.85 16.54.7 24.82-.07 3.51-2 5.05-5.63 5.06H949.33m-10.8-15.42c3.9 0 7.81 0 11.71 0 1.28 0 1.9-.42 1.86-1.78-.06-2.12.06-4.25-.05-6.36-.37-7.28-4.38-12-11.37-12.9-7.22-.95-14.13 1.85-15.39 10.94-.38 2.73-.1 5.47-.22 8.2-.07 1.44.56 1.92 1.95 1.9 3.84-.05 7.67 0 11.51 0M808 424.22q0-19.22 0-38.44c0-4.34 1.42-6.12 5.53-7.49a99.42 99.42 0 0 1 31.89-5.45c10.53 0 20.65 1.84 29 9 6.7 5.75 9.8 13.34 11.14 21.84a53.77 53.77 0 0 1 .45 8.4q0 25.8 0 51.6c0 4.41-1.64 6.09-6.1 6.06-3.35 0-6.72.3-10.06-.24-5.57-.91-9.18-5-9.2-10.64-.06-14.6 0-29.19 0-43.79a48.87 48.87 0 0 0-.75-9.81c-1.32-6.41-5.54-10-12.06-10.29a61 61 0 0 0-11.68.69c-2 .31-2.55 1.19-2.54 3.11q.07 31.44 0 62.9c0 .82 0 1.65 0 2.46a5 5 0 0 1-5 4.81c-5.28.1-10.57.11-15.85 0-3-.06-4.77-2.09-4.78-5.27q0-19.74 0-39.47"></path>
    <path fill="#5f259f" d="M350,388.34c0,7.61-.05,15.21,0,22.81a3,3,0,0,1-2.31,3.3,36.61,36.61,0,0,1-15.21,1.84c-8.75-.83-13.64-6-14.38-14.87-.68-8.14-.18-16.29-.32-24.44-.06-4,0-7.94,0-11.91,0-1.65.54-2.32,2.27-2.31,9.19.06,18.38.08,27.56,0,2,0,2.42.81,2.41,2.58-.06,7.67,0,15.34,0,23"></path>
  </g>
</svg>
);

const PaytmIcon = () => (
  <svg width="64" height="64" viewBox="-164 191.6 512 193" xmlns="http://www.w3.org/2000/svg" style={{ width: '64px', height: '64px' }}>
    <g>
      <path d="M229.8,243.2c2-1.6,3-2.4,4-3.2c13.9-11.8,31.7-10.5,43.6,3.5c1.2,1.4,1.8,1.5,3,0.3c0.8-0.9,1.7-1.6,2.5-2.5   c9.3-9.1,21.6-11.8,33.1-6.7c12.1,5.4,18.6,14.9,18.7,28.2c0.2,28.7,0.1,57.3,0.1,86c0,10.2-6.3,16.6-16.4,16.6c-4,0-8-0.3-12,0.1   c-4.1,0.4-5.3-0.9-5.3-5.2c0.2-28,0.1-56,0.1-84c0-1.2,0-2.3,0-3.5c-0.1-6.5-2.7-9.2-8.9-9.5c-5.6-0.3-9.5,3.1-10.1,8.8   c-0.1,1.3,0,2.7,0,4c0,24.2,0,48.3,0,72.5c0,10.6-6.1,16.8-16.7,16.7c-5.4-0.1-12.7,2.4-15.8-1.1c-2.7-3-0.9-10.1-0.9-15.4   c0-24.8,0-49.7,0-74.5c0-8.8-5.7-13.3-13.1-10.3c-4.6,1.9-6.1,5.6-6.1,10.4c0.1,23.2,0,46.3,0,69.5c0,1.8,0,3.7,0,5.5   c-0.3,9.7-6.5,15.8-16.1,15.9c-4,0.1-8-0.3-12,0.1c-4.3,0.4-5.6-0.8-5.5-5.4c0.2-39.3,0.1-78.6,0.1-118c0-1.7,0.1-3.3,0-5   c-0.2-2.2,0.7-2.9,2.9-2.9c9.2,0.1,18.3,0.1,27.5,0c2.3,0,3.4,0.6,3.2,3.1C229.5,239,229.7,240.6,229.8,243.2z" style={{fill:"#02b9ef"}}></path>
      <path d="M17.8 297.4c0 13.7 0 27.3 0 41-.1 17.8-9.4 27-27.2 27.1-7.8 0-15.7.1-23.5 0-15.8-.2-27.4-10.7-28.2-26.5-.6-11.3-.7-22.7-.1-34 .8-16.2 13.2-27.6 29.6-27.8 4.3-.1 8.7 0 13 0 4.2-.1 5.8-2.5 5.7-6.5 0-4-1.8-5.8-5.8-5.6-4.5.1-9 .1-13.5 0-11-.2-17.1-6.2-17-17 0-4.4-2-10.3.9-12.9 2.5-2.2 8.2-.8 12.5-.8 11.2-.1 22.3 0 33.5 0 11.9 0 20 8.1 20.1 20.1C17.9 268.7 17.8 283.1 17.8 297.4zM-12.8 320.1c0-1.7 0-3.3 0-5 0-10.2 0-10.2-10.2-9.8-5.1.2-7.9 2.8-8 8.1-.1 4.2-.1 8.3 0 12.5.1 7.2 3.3 9.1 13.7 9.4 7.7.2 3.8-5.2 4.5-8.2C-12.4 324.9-12.9 322.4-12.8 320.1zM106.8 286.5c0 15.3.2 30.7-.1 46-.2 11.8-3 22.5-14.4 28.8-4.6 2.5-9.6 3.9-14.8 4-11.5.2-23 0-34.5.2-2.8 0-3.4-1-3.3-3.5.2-4.2-.1-8.3.1-12.5.2-8 6.3-14.1 14.3-14.4 5.2-.2 10.3-.1 15.5 0 4.2 0 6.5-1.7 6.5-6.2 0-4.6-2.2-6.2-6.4-6.3-7-.2-14 .8-20.9-1.2-11.9-3.5-20.6-13.4-20.9-25.7-.6-19.5-.2-39-.3-58.5 0-2.2.7-2.9 2.9-2.8 8.2.1 16.3.2 24.5 0 3.6-.1 3.1 1.9 3.1 4.1 0 14.7 0 29.3 0 44 0 6.4 3 9.8 8.6 10 6.6.2 9.5-2.5 9.5-9.2 0-14.8.1-29.7-.1-44.5 0-3.5.9-4.5 4.4-4.4 7.3.3 14.7.4 22 0 4-.2 4.6 1.3 4.5 4.8C106.7 254.9 106.8 270.7 106.8 286.5zM-148 309.2c0-16.3 0-32.7 0-49 0-16 9.8-26 25.9-25.8 10.5.1 21-1.2 31.4.8 13.3 2.6 21.7 12.9 21.8 26.6.1 14.5 0 29 0 43.5 0 18.2-10.7 29.3-28.9 29.8-5.5.2-11 .1-16.5 0-2.5-.1-3.6.7-3.5 3.4.2 4 .1 8 0 12-.2 8.6-6.3 14.8-14.8 14.9-5 .1-11.3 2.1-14.5-.8-3-2.7-.8-9.1-.9-13.9C-148.1 336.9-148 323-148 309.2zM-117.8 284.7c0 3.2 0 6.3 0 9.5 0 11.3 0 11.3 11.3 10.3 4.9-.4 7.2-2.8 7.3-7.7.1-5.6-.2-11.3.1-16.9.6-16.2-2.4-14.6-15.6-14.7-2.4 0-3.2.7-3.2 3.1C-117.7 273.7-117.8 279.2-117.8 284.7z" style={{fill:"#06306f"}}></path>
      <path d="M135.1,309.4c0-13.3-0.1-26.7,0.1-40c0-3.1-0.7-4.4-4.1-4.3c-4.5,0.2-10.5,1.5-13-0.7   c-3.1-2.9-0.7-9.1-1.1-13.9c0-0.3,0-0.7,0-1c0-4.7-1.5-10.2,0.5-13.7s8.1-1.3,12.4-2.4c8.5-2.2,14.9-7.1,20.1-13.9   c3.6-4.6,8.1-7.9,13.9-9c3.1-0.6,5-0.2,4.8,3.8c-0.3,5.6,0,11.3-0.1,17c-0.1,2.4,0.8,3.2,3.2,3.1c4-0.1,8,0.1,12-0.1   c2.4-0.1,3.2,0.8,3.1,3.2c-0.1,8.2-0.1,16.3,0,24.5c0,2.3-0.6,3.5-3.1,3.2c-0.5-0.1-1,0-1.5,0c-4.4,0.4-10.5-2-12.8,1   c-2.2,2.8-0.8,8.6-0.8,13.1c0,27.2-0.1,54.3,0.1,81.5c0,3.8-1,5-4.8,4.7c-3.6-0.3-7.3,0-11-0.1c-10.8-0.4-17.9-7.7-17.9-18.5   C135.1,334.4,135.1,321.9,135.1,309.4z" style={{fill:"#02b9ef"}}></path>
    </g>
  </svg>
);

const BHIMIcon = () => (
  <svg width="64" height="64" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" style={{ width: '64px', height: '64px' }}>
    <path fill="#707174" d="M19.738 30.04a.865.865 0 0 1 .408 1.182c-.242.787-.442 1.587-.66 2.381a1.45 1.45 0 0 1-1.698 1.307q-5.013.001-10.027.008c-.265 0-.36-.024-.276-.32q1.289-4.576 2.554-9.157a.36.36 0 0 1 .41-.317c3.443.009 6.885.006 10.327.011a.693.693 0 0 1 .778.957 89.037 89.037 0 0 1-.839 3.041 1.458 1.458 0 0 1-.977.907zm-4.614-2.99c-1.067 0-2.134.008-3.201-.005a.409.409 0 0 0-.488.389 11.042 11.042 0 0 1-.348 1.23c-.089.275-.075.417.28.416 2.148-.012 4.296-.002 6.444-.01a1.276 1.276 0 0 0 1.272-1.05.694.694 0 0 0-.759-.969c-1.066-.003-2.133 0-3.2-.001zm-1.622 5.962h3.154a1.299 1.299 0 0 0 1.178-.64c.434-.704.14-1.388-.604-1.391-2.145-.009-4.29 0-6.435-.008a.372.372 0 0 0-.428.31c-.113.44-.214.885-.366 1.312-.135.382.022.425.348.42 1.05-.013 2.102-.004 3.153-.003zm34.421-2.601c-.328.29-.656.574-.975.868q-1.836 1.69-3.663 3.387c-.203.19-.306.221-.466-.058-.9-1.58-1.819-3.15-2.733-4.723a.929.929 0 0 0-.1-.115 1.17 1.17 0 0 0-.246.61q-.575 2.053-1.121 4.113a.433.433 0 0 1-.516.41c-.41-.031-.825-.01-1.237-.005-.19.003-.295-.025-.229-.265q1.287-4.642 2.562-9.288a.412.412 0 0 1 .073-.092 1.62 1.62 0 0 1 .393.534q1.735 2.885 3.461 5.776c.259.432.252.423.64.092q3.129-2.67 6.265-5.331l1.295-1.104a.956.956 0 0 1-.102.604c-.792 2.906-1.598 5.809-2.386 8.716a.393.393 0 0 1-.464.363 11.05 11.05 0 0 0-1.194-.002c-.341.02-.368-.106-.285-.4.362-1.27.703-2.547 1.051-3.82a.235.235 0 0 0-.023-.27zm-20.056-1.344c1.124 0 2.248-.021 3.37.011a.534.534 0 0 0 .607-.494c.263-1.002.545-2 .792-3.007a.477.477 0 0 1 .581-.447 8.044 8.044 0 0 0 1.109.001c.299-.015.367.072.284.368-.424 1.505-.83 3.015-1.242 4.523-.396 1.452-.801 2.902-1.182 4.358a.56.56 0 0 1-.693.531 6.133 6.133 0 0 0-1.065-.004c-.286.013-.333-.081-.255-.35.305-1.05.583-2.109.886-3.16.088-.308.048-.432-.315-.43q-3.435.02-6.87.002a.47.47 0 0 0-.542.438c-.265 1.06-.58 2.11-.856 3.167a.372.372 0 0 1-.445.333 10.132 10.132 0 0 0-1.194 0c-.415.03-.347-.186-.276-.444q.675-2.446 1.341-4.893c.375-1.37.752-2.74 1.119-4.113a.35.35 0 0 1 .404-.326c.425.02.853.018 1.28 0 .296-.013.328.097.255.355-.304 1.08-.582 2.167-.894 3.245-.083.287-.012.343.26.34 1.18-.009 2.361-.003 3.541-.004zm9.104-3.906h.426c.566 0 .57.001.425.524q-1.187 4.309-2.38 8.616c-.178.643-.185.641-.846.642-.312 0-.625-.01-.937.003-.281.012-.337-.081-.26-.354q1.132-4.04 2.242-8.086a6.828 6.828 0 0 0 .228-.862.487.487 0 0 1 .634-.486 3.54 3.54 0 0 0 .468.003z"></path>
    <path fill="#f07a25" d="m52.518 32.906-2.092 1.945-.068-.054c.24-.887.476-1.775.72-2.66q.91-3.304 1.825-6.606a.302.302 0 0 1 .15-.284c.146-.025.144.143.194.235.31.574.546 1.186.908 1.731a24.21 24.21 0 0 0 1.178 2.452.488.488 0 0 1-.144.685c-.901.84-1.783 1.702-2.671 2.556Z"></path>
    <path fill="#0c8d48" d="M52.518 32.906c.888-.854 1.77-1.716 2.67-2.556a.488.488 0 0 0 .145-.685 24.21 24.21 0 0 1-1.178-2.452l.623-2.092c.257.5.472.907.68 1.32.524 1.04 1.032 2.087 1.572 3.118a.605.605 0 0 1-.17.861c-1.482 1.37-2.931 2.775-4.393 4.166a.776.776 0 0 1-.364.263 13.182 13.182 0 0 0 .415-1.943Z"></path>
  </svg>
);

const GPayIcon = () => (
  <svg width="64" height="64" viewBox="0 0 5000 3000" xmlns="http://www.w3.org/2000/svg" style={{ width: '64px', height: '64px' }}>
    <g>
      <path fill="#5f6368" d="M2446.64 926.9v436.56h269.25q96.17 0 159.13-64.62 64.68-64.54 64.64-153.7 0-87.26-64.64-152-63-66.34-159.13-66.36H2446.64zm0 590.27v506.42H2285.85V773.21h426.59q162.6 0 276.09 108.27Q3104.1 989.71 3104 1145.14q0 159-115.48 265.41-111.84 106.6-276.09 106.52h-265.8zM3266.48 1761.61q0 63 53.35 104.83c35.61 27.88 77.18 41.87 125 41.87 67.67 0 127.81-25.06 180.86-75.08s79.56-108.81 79.56-176.25q-75.15-59.51-209.77-59.42-97.91 0-163.42 47.21c-43.64 31.42-65.57 70.26-65.57 116.84zM3474.59 1140q178.41 0 281.5 95.17t103.07 261v527.41H3705.35V1904.86h-7q-99.61 146.6-265.64 146.61-141.59 0-236.93-83.75-95.37-84-95.33-209.67 0-132.66 100.45-211.18t268.36-78.62q143.31 0 236 52.36v-36.7q0-83.81-66.4-142.27c-44.38-39.05-96.07-58.47-155.59-58.47q-134.7 0-213.22 113.55l-141.69-89.12q117.32-167.67 346.25-167.64z"></path>
      <polygon fill="#5f6368" points="4742 1167.88 4205.2 2400.72 4039.17 2400.72 4238.5 1969.4 3885.37 1167.88 4060.26 1167.88 4315.46 1782.59 4318.91 1782.59 4567.1 1167.88 4742 1167.88"></polygon>
    </g>
    <g>
      <path fill="#4285f4" d="M1796.76,1408a855.84,855.84,0,0,0-12.38-146.12H1106.09v276.69h388.48c-16.65,90.22-67.07,167-143.62,218.33v179.7h231.86c135.73-125.09,214-310,214-528.6Z"></path>
      <path fill="#34a853" d="M1106.09,2110.14c194.11,0,357.52-63.7,476.72-173.54L1351,1756.9c-64.53,43.44-147.65,68.81-244.86,68.81-187.59,0-346.82-126.33-403.78-296.59H463.45v185.09c118.37,234.72,361.65,395.93,642.64,395.93Z"></path>
      <path fill="#fabb05" d="M702.31,1529.12a430.39,430.39,0,0,1,0-275V1069H463.45a717.68,717.68,0,0,0,0,645.19Z"></path>
      <path fill="#e94235" d="M1106.09,957.55c106,0,201,36.4,275.92,107.76v.1L1587.3,860.34c-124.68-116-287.2-187.17-481.21-187.17-281,0-524.27,161.11-642.64,395.85l238.86,185.07c57-170.26,216.19-296.54,403.78-296.54Z"></path>
    </g>
  </svg>
);

const UPIIcon = () => (
  <svg width="28" height="28" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" style={{ width: '28px', height: '28px' }}>
    <path fill="#707174" d="M19.738 30.04a.865.865 0 0 1 .408 1.182c-.242.787-.442 1.587-.66 2.381a1.45 1.45 0 0 1-1.698 1.307q-5.013.001-10.027.008c-.265 0-.36-.024-.276-.32q1.289-4.576 2.554-9.157a.36.36 0 0 1 .41-.317c3.443.009 6.885.006 10.327.011a.693.693 0 0 1 .778.957 89.037 89.037 0 0 1-.839 3.041 1.458 1.458 0 0 1-.977.907zm-4.614-2.99c-1.067 0-2.134.008-3.201-.005a.409.409 0 0 0-.488.389 11.042 11.042 0 0 1-.348 1.23c-.089.275-.075.417.28.416 2.148-.012 4.296-.002 6.444-.01a1.276 1.276 0 0 0 1.272-1.05.694.694 0 0 0-.759-.969c-1.066-.003-2.133 0-3.2-.001zm-1.622 5.962h3.154a1.299 1.299 0 0 0 1.178-.64c.434-.704.14-1.388-.604-1.391-2.145-.009-4.29 0-6.435-.008a.372.372 0 0 0-.428.31c-.113.44-.214.885-.366 1.312-.135.382.022.425.348.42 1.05-.013 2.102-.004 3.153-.003zm34.421-2.601c-.328.29-.656.574-.975.868q-1.836 1.69-3.663 3.387c-.203.19-.306.221-.466-.058-.9-1.58-1.819-3.15-2.733-4.723a.929.929 0 0 0-.1-.115 1.17 1.17 0 0 0-.246.61q-.575 2.053-1.121 4.113a.433.433 0 0 1-.516.41c-.41-.031-.825-.01-1.237-.005-.19.003-.295-.025-.229-.265q1.287-4.642 2.562-9.288a.412.412 0 0 1 .073-.092 1.62 1.62 0 0 1 .393.534q1.735 2.885 3.461 5.776c.259.432.252.423.64.092q3.129-2.67 6.265-5.331l1.295-1.104a.956.956 0 0 1-.102.604c-.792 2.906-1.598 5.809-2.386 8.716a.393.393 0 0 1-.464.363 11.05 11.05 0 0 0-1.194-.002c-.341.02-.368-.106-.285-.4.362-1.27.703-2.547 1.051-3.82a.235.235 0 0 0-.023-.27zm-20.056-1.344c1.124 0 2.248-.021 3.37.011a.534.534 0 0 0 .607-.494c.263-1.002.545-2 .792-3.007a.477.477 0 0 1 .581-.447 8.044 8.044 0 0 0 1.109.001c.299-.015.367.072.284.368-.424 1.505-.83 3.015-1.242 4.523-.396 1.452-.801 2.902-1.182 4.358a.56.56 0 0 1-.693.531 6.133 6.133 0 0 0-1.065-.004c-.286.013-.333-.081-.255-.35.305-1.05.583-2.109.886-3.16.088-.308.048-.432-.315-.43q-3.435.02-6.87.002a.47.47 0 0 0-.542.438c-.265 1.06-.58 2.11-.856 3.167a.372.372 0 0 1-.445.333 10.132 10.132 0 0 0-1.194 0c-.415.03-.347-.186-.276-.444q.675-2.446 1.341-4.893c.375-1.37.752-2.74 1.119-4.113a.35.35 0 0 1 .404-.326c.425.02.853.018 1.28 0 .296-.013.328.097.255.355-.304 1.08-.582 2.167-.894 3.245-.083.287-.012.343.26.34 1.18-.009 2.361-.003 3.541-.004zm9.104-3.906h.426c.566 0 .57.001.425.524q-1.187 4.309-2.38 8.616c-.178.643-.185.641-.846.642-.312 0-.625-.01-.937.003-.281.012-.337-.081-.26-.354q1.132-4.04 2.242-8.086a6.828 6.828 0 0 0 .228-.862.487.487 0 0 1 .634-.486 3.54 3.54 0 0 0 .468.003z"></path>
    <path fill="#f07a25" d="m52.518 32.906-2.092 1.945-.068-.054c.24-.887.476-1.775.72-2.66q.91-3.304 1.825-6.606a.302.302 0 0 1 .15-.284c.146-.025.144.143.194.235.31.574.546 1.186.908 1.731a24.21 24.21 0 0 0 1.178 2.452.488.488 0 0 1-.144.685c-.901.84-1.783 1.702-2.671 2.556Z"></path>
    <path fill="#0c8d48" d="M52.518 32.906c.888-.854 1.77-1.716 2.67-2.556a.488.488 0 0 0 .145-.685 24.21 24.21 0 0 1-1.178-2.452l.623-2.092c.257.5.472.907.68 1.32.524 1.04 1.032 2.087 1.572 3.118a.605.605 0 0 1-.17.861c-1.482 1.37-2.931 2.775-4.393 4.166a.776.776 0 0 1-.364.263 13.182 13.182 0 0 0 .415-1.943Z"></path>
  </svg>
);

const UPIPay: React.FC = () => {
  const [upiInfo, setUpiInfo] = useState<UPIPaymentInfo | null>(null);
  const [loading, setLoading] = useState<boolean>(true);
  const { toast } = useToast();

  useEffect(() => {
    fetchUPIInfo();
  }, []);

  const fetchUPIInfo = async () => {
    try {
      const response = await getUPIPaymentInfo();
      setUpiInfo(response.data);
    } catch (error) {
      console.error('Failed to fetch UPI payment info:', error);
    } finally {
      setLoading(false);
    }
  };

  const copyToClipboard = async (text: string) => {
    try {
      await navigator.clipboard.writeText(text);
      toast({
        title: "Copied!",
        description: "UPI ID copied to clipboard",
      });
    } catch (error) {
      console.error('Failed to copy:', error);
    }
  };

  if (loading) {
    return (
      <div 
        className="fixed inset-0 flex items-center justify-center"
        style={{ 
          background: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #533483 75%, #1a1a2e 100%)'
        }}
      >
        <div className="text-center">
          <Loader2 className="w-16 h-16 animate-spin text-purple-400 mx-auto mb-4" />
          <p className="text-white text-xl">Loading payment information...</p>
        </div>
      </div>
    );
  }

  if (!upiInfo) {
    return (
      <div 
        className="fixed inset-0 flex items-center justify-center"
        style={{ 
          background: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #533483 75%, #1a1a2e 100%)'
        }}
      >
        <div className="text-center px-4">
          <p className="text-white text-xl">Payment information not available. Please check back later.</p>
        </div>
      </div>
    );
  }

  return (
    <div 
      className="fixed inset-0 overflow-hidden md:overflow-y-auto"
      data-testid="upi-pay-page"
      style={{ 
        minHeight: '100svh', 
        width: '100vw',
        background: 'linear-gradient(135deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #533483 75%, #1a1a2e 100%)'
      }}
    >
      {/* Main Content - absolute header/footer, truly centered middle */}
      <div className="relative w-full h-full">
        {/* Header: Logo pinned to top */}
        <div className="absolute top-0 left-0 right-0 px-4">
          {upiInfo.logo_url && (
            <motion.div
              initial={{ opacity: 0, y: -12 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.4 }}
              className="pt-5 pb-2 flex justify-center"
            >
              <img
                src={upiInfo.logo_url}
                alt="Logo"
                className="max-h-16 sm:max-h-24 max-w-24 sm:max-w-28 object-contain"
                onError={(e) => {
                  const target = e.target as HTMLImageElement;
                  target.style.display = 'none';
                }}
              />
            </motion.div>
          )}
        </div>

        {/* Center: perfectly centered within the viewport (nudged slightly upward) */}
        <div className="absolute inset-0 px-4 pt-24 pb-16 flex items-center justify-center -translate-y-1 sm:-translate-y-2 md:-translate-y-3">
          <div className="w-full max-w-md mx-auto flex flex-col items-center justify-center">
            <div className="w-full flex flex-col items-center gap-3 sm:gap-4 rounded-2xl border border-white/10 bg-white/5 backdrop-blur-sm p-4 sm:p-6">

          {/* Scan From UPI Apps Section */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5, delay: 0.2 }}
            className="text-center space-y-2"
          >
            <p className="text-white text-xs sm:text-sm md:text-sm opacity-90">
              Scan From any UPI app
            </p>
            <div className="flex items-center justify-center gap-1.5 sm:gap-2 flex-wrap">
              <div className="flex items-center gap-1.5">
                <PhonePeIcon />
               {/* <span className="text-white text-sm sm:text-base">PhonePe</span>*/}
              </div>
              <div className="flex items-center gap-1.5">
                <PaytmIcon />
                {/* <span className="text-white text-sm sm:text-base">Paytm</span>*/}
              </div>
              <div className="flex items-center gap-1.5">
                <BHIMIcon />
               {/*  <span className="text-white text-sm sm:text-base">BHIM</span>*/}
              </div>
              <div className="flex items-center gap-1.5">
                <GPayIcon />
              {/*   <span className="text-white text-sm sm:text-base">G Pay</span>*/}
              </div>
            </div>
          </motion.div>

          {/* QR Code Section */}
          <motion.div
            initial={{ opacity: 0, scale: 0.98 }}
            animate={{ opacity: 1, scale: 1 }}
            transition={{ duration: 0.5, delay: 0.25 }}
            className="flex justify-center"
          >
            {upiInfo.qr_code_url ? (
              <div 
                className="relative bg-white rounded-2xl shadow-xl p-3 sm:p-4"
                style={{ 
                  // Keep square; tighter mobile budget to avoid scroll, cap size on desktop
                  width: 'min(72vw, calc(100svh - 320px), 320px)',
                  height: 'min(72vw, calc(100svh - 320px), 320px)',
                }}
              >
                <img
                  src={upiInfo.qr_code_url}
                  alt="UPI QR Code"
                  className="w-full h-full object-contain"
                  style={{ aspectRatio: '1' }}
                  onError={(e) => {
                    const target = e.target as HTMLImageElement;
                    target.style.display = 'none';
                  }}
                />
              </div>
            ) : (
              <div 
                className="bg-gray-800 border-2 border-dashed border-gray-600 rounded-2xl flex items-center justify-center"
                style={{ 
                  width: 'min(72vw, calc(100svh - 320px), 320px)',
                  height: 'min(72vw, calc(100svh - 320px), 320px)'
                }}
              >
                <div className="text-center text-gray-400 px-4">
                  <p className="text-sm sm:text-base md:text-lg">QR Code not available</p>
                </div>
              </div>
            )}
          </motion.div>
              {/* Company Name below QR */}
              {upiInfo.company_name && (
                <motion.div
                  initial={{ opacity: 0, y: 8 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ duration: 0.4, delay: 0.3 }}
                  className="w-full text-center"
                >
                  <p className="text-white text-sm sm:text-base font-semibold truncate">
                    {upiInfo.company_name}
                  </p>
                </motion.div>
              )}
            </div>

          {/* UPI ID Section */}
          {upiInfo.upi_id && (
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.5, delay: 0.4 }}
              className="text-center"
            >
              <div className="inline-flex items-center gap-2">
                <p className="text-white text-sm sm:text-base font-bold font-mono">
                  {upiInfo.upi_id}
                </p>
                <button
                  onClick={() => copyToClipboard(upiInfo.upi_id)}
                  className="p-1 hover:bg-gray-700/50 rounded-lg text-white transition-colors active:scale-95"
                  aria-label="Copy UPI ID"
                >
                  <Copy className="w-4 h-4" />
                </button>
              </div>
            </motion.div>
          )}
          </div>
        </div>

        {/* Footer: Powered By pinned to bottom */}
        <div className="absolute bottom-0 left-0 right-0 px-4">
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ duration: 0.5, delay: 0.5 }}
            className="w-full max-w-md mx-auto text-center space-y-0.5 pt-1 pb-3"
          >
            <p className="text-gray-400 text-xs">Powered BY</p>
            <div className="flex items-center justify-center gap-1.5">
              <UPIIcon />
                 {/*  <span className="text-white text-lg sm:text-xl md:text-2xl font-bold">UPI</span> */}
            </div>
            <p className="text-gray-400 text-xs">Unified Payments Interface</p>
          </motion.div>
        </div>
      </div>
    </div>
  );
};

export default UPIPay;
